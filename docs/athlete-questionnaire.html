<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athlete Intake | Gravel God Coaching</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Sometype+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --gg-cream: #F5F5DC;
            --gg-charcoal: #2c2c2c;
            --gg-brown: #59473C;
            --gg-muted: #8C7568;
            --gg-yellow: #F4D03F;
            --gg-turquoise: #4ECDC4;
            --gg-white: #ffffff;
            --gg-red: #e74c3c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background: var(--gg-cream);
            color: var(--gg-charcoal);
            font-family: "Sometype Mono", ui-monospace, monospace;
            font-size: 15px;
            line-height: 1.7;
            min-height: 100vh;
        }

        .container { max-width: 720px; margin: 0 auto; padding: 48px 24px; }

        /* Header */
        .header { text-align: center; margin-bottom: 48px; }
        .header-badge {
            display: inline-block;
            background: var(--gg-yellow);
            color: var(--gg-charcoal);
            padding: 8px 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            border: 3px solid var(--gg-charcoal);
            box-shadow: 4px 4px 0 var(--gg-charcoal);
            margin-bottom: 20px;
        }
        .header h1 { font-size: 28px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; margin-bottom: 12px; }
        .header p { color: var(--gg-muted); font-size: 14px; max-width: 520px; margin: 0 auto; }

        /* Progress bar */
        .progress-container {
            background: var(--gg-white);
            border: 2px solid var(--gg-charcoal);
            padding: 16px 20px;
            margin-bottom: 24px;
        }
        .progress-bar {
            height: 8px;
            background: var(--gg-cream);
            border: 1px solid var(--gg-charcoal);
            margin-bottom: 8px;
        }
        .progress-fill {
            height: 100%;
            background: var(--gg-turquoise);
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            font-size: 12px;
            color: var(--gg-muted);
            text-align: center;
        }

        /* Form */
        .form-card {
            background: var(--gg-white);
            border: 3px solid var(--gg-charcoal);
            box-shadow: 6px 6px 0 var(--gg-charcoal);
            padding: 32px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gg-charcoal);
            padding-bottom: 8px;
            border-bottom: 2px solid var(--gg-charcoal);
            margin-bottom: 24px;
            margin-top: 32px;
        }
        .section-title:first-of-type { margin-top: 0; }

        .section-help {
            font-size: 13px;
            color: var(--gg-muted);
            margin-top: -16px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .flexible-option {
            background: var(--gg-cream);
            border-style: dashed;
        }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--gg-charcoal); }
        .form-label .required { color: var(--gg-red); }
        .form-label .optional { font-weight: 400; color: var(--gg-muted); font-size: 12px; }
        .form-help { font-size: 12px; color: var(--gg-muted); margin-top: 4px; }

        input[type="text"], input[type="email"], input[type="number"], input[type="date"], input[type="time"], select, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid var(--gg-charcoal);
            background: var(--gg-white);
            color: var(--gg-charcoal);
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gg-turquoise);
            box-shadow: 3px 3px 0 var(--gg-turquoise);
        }
        input.error, select.error { border-color: var(--gg-red); }
        textarea { min-height: 80px; resize: vertical; }
        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%232c2c2c' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* Radio/Checkbox groups */
        .radio-group { display: flex; flex-direction: column; gap: 10px; }
        .radio-group.horizontal { flex-direction: row; flex-wrap: wrap; gap: 10px; }
        .radio-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px 16px;
            border: 2px solid var(--gg-charcoal);
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }
        .radio-group.horizontal .radio-option { flex: 1; min-width: 100px; }
        .radio-option:hover { background: var(--gg-cream); }
        .radio-option.selected { background: var(--gg-cream); border-color: var(--gg-turquoise); }
        .radio-option input { margin-top: 2px; accent-color: var(--gg-turquoise); }
        .radio-label { flex: 1; }
        .radio-title { font-weight: 600; font-size: 14px; }
        .radio-desc { font-size: 12px; color: var(--gg-muted); margin-top: 2px; }

        /* Checkbox */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 8px;
        }
        .checkbox-group.vertical {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .checkbox-option {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 12px;
            border: 2px solid var(--gg-charcoal);
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s, border-color 0.2s;
            min-height: 40px;
        }
        .checkbox-group.vertical .checkbox-option {
            justify-content: flex-start;
        }
        .checkbox-option:hover { background: var(--gg-cream); }
        .checkbox-option.selected { background: var(--gg-cream); border-color: var(--gg-turquoise); }
        .checkbox-option input { accent-color: var(--gg-turquoise); }
        .checkbox-option .checkbox-label { flex: 1; }
        .checkbox-option .checkbox-desc { font-size: 11px; color: var(--gg-muted); }

        /* Inline fields */
        .inline-fields { display: flex; gap: 16px; }
        .inline-fields .form-group { flex: 1; }
        .inline-fields-3 { display: flex; gap: 12px; }
        .inline-fields-3 .form-group { flex: 1; }
        .inline-fields-4 { display: flex; gap: 10px; }
        .inline-fields-4 .form-group { flex: 1; }

        .input-with-unit { display: flex; align-items: center; gap: 8px; }
        .input-with-unit input { flex: 1; }
        .input-unit { font-size: 13px; color: var(--gg-muted); white-space: nowrap; }

        /* Calculated metrics display */
        .calc-display {
            background: var(--gg-cream);
            border: 2px solid var(--gg-charcoal);
            padding: 12px 16px;
            margin-top: 12px;
            font-size: 13px;
        }
        .calc-row { display: flex; justify-content: space-between; margin: 4px 0; }
        .calc-label { color: var(--gg-muted); }
        .calc-value { font-weight: 700; color: var(--gg-charcoal); }
        .calc-value.highlight { color: var(--gg-turquoise); }

        /* Conditional section */
        .conditional { display: none; }
        .conditional.show { display: block; }

        /* Submit button */
        .submit-btn {
            display: block;
            width: 100%;
            background: var(--gg-turquoise);
            color: var(--gg-charcoal);
            padding: 18px 32px;
            font-family: inherit;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 3px solid var(--gg-charcoal);
            box-shadow: 6px 6px 0 var(--gg-charcoal);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            margin-top: 8px;
        }
        .submit-btn:hover { transform: translate(3px, 3px); box-shadow: 3px 3px 0 var(--gg-charcoal); }
        .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: 6px 6px 0 var(--gg-charcoal); }

        /* Save button */
        .save-btn {
            background: var(--gg-cream);
            color: var(--gg-charcoal);
            padding: 12px 24px;
            font-family: inherit;
            font-size: 13px;
            font-weight: 600;
            border: 2px solid var(--gg-charcoal);
            cursor: pointer;
            margin-right: 12px;
        }
        .save-btn:hover { background: var(--gg-white); }

        /* Footer */
        .footer { text-align: center; margin-top: 24px; }
        .footer p {
            font-size: 13px;
            color: var(--gg-muted);
            max-width: 520px;
            margin: 0 auto;
            line-height: 1.7;
        }

        /* Messages */
        .message { padding: 16px 20px; margin-bottom: 24px; border: 3px solid; font-size: 14px; }
        .message.success { background: #d4edda; border-color: #28a745; color: #155724; }
        .message.error { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        .message.warning { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .message.info { background: #e7f3ff; border-color: #4ECDC4; color: #0c5460; }

        .hidden { display: none !important; }
        .honeypot { position: absolute; left: -9999px; }

        /* Responsive */
        @media (max-width: 600px) {
            .container { padding: 24px 16px; }
            .form-card { padding: 24px 20px; }
            .inline-fields, .inline-fields-3, .inline-fields-4 { flex-direction: column; gap: 0; }
            .radio-group.horizontal { flex-direction: column; }
            .radio-group.horizontal .radio-option { min-width: auto; }
            .header h1 { font-size: 24px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-badge">Athlete Intake</div>
            <h1>Let's Get Started</h1>
            <p>This questionnaire helps me understand you as an athlete. The more detail you provide, the better I can tailor your coaching. Takes about 15 minutes.</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">0% complete</div>
        </div>

        <div id="message" class="message hidden"></div>

        <form id="intake-form" class="form-card">
            <input type="text" name="website" class="honeypot" tabindex="-1" autocomplete="off">
            <input type="hidden" name="form_type" value="coaching_intake">
            <input type="hidden" name="watts_per_kg" id="watts_per_kg" value="">
            <input type="hidden" name="estimated_category" id="estimated_category" value="">
            <input type="hidden" name="blindspots" id="blindspots" value="">
            <input type="hidden" name="inferred_traits" id="inferred_traits" value="">

            <!-- ==================== SECTION 1: CONTACT ==================== -->
            <div class="section-title">1. Basic Info</div>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="name">Full Name <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required placeholder="First Last">
                </div>
                <div class="form-group">
                    <label class="form-label" for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="you@email.com">
                </div>
            </div>

            <div class="inline-fields-4">
                <div class="form-group">
                    <label class="form-label" for="sex">Sex <span class="required">*</span></label>
                    <select id="sex" name="sex" required>
                        <option value="">Select</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="age">Age <span class="required">*</span></label>
                    <input type="number" id="age" name="age" required placeholder="35" min="16" max="90">
                </div>
                <div class="form-group">
                    <label class="form-label" for="weight">Weight <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="weight" name="weight" required placeholder="165" min="80" max="350">
                        <span class="input-unit">lbs</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Height <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="height_ft" name="height_ft" required placeholder="5" min="4" max="7" style="width: 50px;">
                        <span class="input-unit">'</span>
                        <input type="number" id="height_in" name="height_in" required placeholder="10" min="0" max="11" style="width: 50px;">
                        <span class="input-unit">"</span>
                    </div>
                </div>
            </div>

            <!-- ==================== SECTION 2: GOALS ==================== -->
            <div class="section-title">2. Goals</div>
            <p class="section-help">What are you training for? This shapes everything.</p>

            <div class="form-group">
                <label class="form-label">I'm training for... <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="primary_goal" value="specific_race" required>
                        <div class="radio-label">
                            <div class="radio-title">Specific Race(s)</div>
                            <div class="radio-desc">I have target events with dates</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="primary_goal" value="general_fitness">
                        <div class="radio-label">
                            <div class="radio-title">General Fitness</div>
                            <div class="radio-desc">Get faster, no specific race</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="primary_goal" value="base_building">
                        <div class="radio-label">
                            <div class="radio-title">Base Building</div>
                            <div class="radio-desc">Building aerobic foundation</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="primary_goal" value="return_from_injury">
                        <div class="radio-label">
                            <div class="radio-title">Return from Injury</div>
                            <div class="radio-desc">Rebuilding after time off</div>
                        </div>
                    </label>
                </div>
            </div>

            <div id="race-details" class="conditional">
                <div class="form-group">
                    <label class="form-label" for="race_list">List your race(s) <span class="required">*</span></label>
                    <textarea id="race_list" name="race_list" placeholder="e.g., Unbound 200 (June 7, 2026) - A priority&#10;Mid South (March 14, 2026) - B priority&#10;Local gravel race (April 5) - C priority" rows="3"></textarea>
                    <div class="form-help">Include name, date, and priority (A = main goal, B = important, C = fun/training)</div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="success_definition">What does success look like? <span class="required">*</span></label>
                    <textarea id="success_definition" name="success_definition" placeholder="e.g., Finish Unbound under 14 hours, top 25% in age group, feel strong in final 50 miles" rows="2"></textarea>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="obstacles">What holds you back from your goals?</label>
                <textarea id="obstacles" name="obstacles" placeholder="e.g., Inconsistent training, poor fueling, fade in long events, time management" rows="2"></textarea>
                <div class="form-help">Be honest - this helps me address real issues</div>
            </div>

            <!-- ==================== SECTION 3: CURRENT FITNESS ==================== -->
            <div class="section-title">3. Current Fitness</div>
            <p class="section-help">Where you're starting from. Estimates are fine if you don't know exact numbers.</p>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="years_cycling">Years Cycling <span class="required">*</span></label>
                    <select id="years_cycling" name="years_cycling" required>
                        <option value="">Select...</option>
                        <option value="0-1">Less than 1 year</option>
                        <option value="1-3">1-3 years</option>
                        <option value="3-5">3-5 years</option>
                        <option value="5-10">5-10 years</option>
                        <option value="10+">10+ years</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="years_structured">Years Structured Training</label>
                    <select id="years_structured" name="years_structured">
                        <option value="">Select...</option>
                        <option value="0">None</option>
                        <option value="1">1 year</option>
                        <option value="2-3">2-3 years</option>
                        <option value="4+">4+ years</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Longest Ride in Last 4 Weeks <span class="required">*</span></label>
                <div class="radio-group horizontal">
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="under-2" required>
                        <div class="radio-label"><div class="radio-title">&lt; 2 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="2-4">
                        <div class="radio-label"><div class="radio-title">2-4 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="4-6">
                        <div class="radio-label"><div class="radio-title">4-6 hrs</div></div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="longest_ride" value="6+">
                        <div class="radio-label"><div class="radio-title">6+ hrs</div></div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Power & Heart Rate <span class="optional">(if known)</span></label>
                <div class="inline-fields-4" style="margin-top: 8px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="ftp" name="ftp" placeholder="FTP" min="50" max="500">
                            <span class="input-unit">W</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_max" name="hr_max" placeholder="Max" min="120" max="220">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_threshold" name="hr_threshold" placeholder="LTHR" min="100" max="200">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <div class="input-with-unit">
                            <input type="number" id="hr_resting" name="hr_resting" placeholder="Rest" min="30" max="100">
                            <span class="input-unit">bpm</span>
                        </div>
                    </div>
                </div>
                <div id="calc-display" class="calc-display hidden">
                    <div class="calc-row">
                        <span class="calc-label">Power-to-Weight:</span>
                        <span class="calc-value highlight" id="calc-wpkg">-</span>
                    </div>
                    <div class="calc-row">
                        <span class="calc-label">Estimated Category:</span>
                        <span class="calc-value" id="calc-category">-</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="strengths">Your Strengths</label>
                <textarea id="strengths" name="strengths" placeholder="e.g., Climbing, mental toughness, consistency, technical skills" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="weaknesses">Your Weaknesses</label>
                <textarea id="weaknesses" name="weaknesses" placeholder="e.g., Sprinting, time trials, heat tolerance, nutrition on the bike" rows="2"></textarea>
            </div>

            <!-- ==================== SECTION 4: BASELINE PHYSIOLOGY ==================== -->
            <div class="section-title">4. Recovery & Baselines</div>
            <p class="section-help">These establish your personal baselines for monitoring recovery and readiness.</p>

            <div class="inline-fields-3">
                <div class="form-group">
                    <label class="form-label" for="rhr_baseline">Resting HR <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="rhr_baseline" name="rhr_baseline" required placeholder="55" min="30" max="100">
                        <span class="input-unit">bpm</span>
                    </div>
                    <div class="form-help">Morning, before getting up</div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sleep_hours_baseline">Typical Sleep <span class="required">*</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="sleep_hours_baseline" name="sleep_hours_baseline" required placeholder="7" min="4" max="12" step="0.5">
                        <span class="input-unit">hrs</span>
                    </div>
                    <div class="form-help">Average per night</div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="hrv_baseline">HRV <span class="optional">(if known)</span></label>
                    <div class="input-with-unit">
                        <input type="number" id="hrv_baseline" name="hrv_baseline" placeholder="45" min="10" max="200">
                        <span class="input-unit">ms</span>
                    </div>
                    <div class="form-help">RMSSD from WHOOP/Garmin</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="sleep_quality">Sleep Quality <span class="required">*</span></label>
                <select id="sleep_quality" name="sleep_quality" required>
                    <option value="">Select...</option>
                    <option value="excellent">Excellent - 7-9 hrs, wake refreshed</option>
                    <option value="good">Good - 6-7 hrs, mostly rested</option>
                    <option value="fair">Fair - 5-6 hrs, often tired</option>
                    <option value="poor">Poor - &lt; 5 hrs, always tired</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Recovery Speed <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="recovery_speed" value="fast" required>
                        <div class="radio-label">
                            <div class="radio-title">Fast</div>
                            <div class="radio-desc">Bounce back quickly, can handle back-to-back hard days</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="recovery_speed" value="normal">
                        <div class="radio-label">
                            <div class="radio-title">Normal</div>
                            <div class="radio-desc">Need a day to recover from hard efforts</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="recovery_speed" value="slow">
                        <div class="radio-label">
                            <div class="radio-title">Slow</div>
                            <div class="radio-desc">Need 2+ days to fully recover, older athlete or high life stress</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="overtraining_history">History of overtraining or burnout?</label>
                <select id="overtraining_history" name="overtraining_history">
                    <option value="">Select...</option>
                    <option value="never">Never</option>
                    <option value="once">Yes, once</option>
                    <option value="multiple">Yes, multiple times</option>
                    <option value="currently">Currently dealing with it</option>
                </select>
            </div>

            <!-- ==================== SECTION 5: EQUIPMENT & INTEGRATIONS ==================== -->
            <div class="section-title">5. Equipment & Data</div>
            <p class="section-help">What devices and platforms do you use? This enables automatic data sync.</p>

            <div class="form-group">
                <label class="form-label">Wearables & Devices</label>
                <div class="checkbox-group vertical">
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="whoop">
                        <div class="checkbox-label">WHOOP <span class="checkbox-desc">- Enables HRV/recovery sync</span></div>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="garmin">
                        <div class="checkbox-label">Garmin Watch/Head Unit</div>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="wahoo">
                        <div class="checkbox-label">Wahoo Head Unit</div>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="power_meter">
                        <div class="checkbox-label">Power Meter (on bike)</div>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="smart_trainer">
                        <div class="checkbox-label">Smart Trainer (Zwift, etc.)</div>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="devices" value="hr_strap">
                        <div class="checkbox-label">HR Chest Strap</div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Training Platform <span class="required">*</span></label>
                <select id="training_platform" name="training_platform" required>
                    <option value="">Select...</option>
                    <option value="intervals_icu">Intervals.icu (recommended - free)</option>
                    <option value="trainingpeaks">TrainingPeaks</option>
                    <option value="strava_only">Strava only</option>
                    <option value="garmin_connect">Garmin Connect</option>
                    <option value="other">Other</option>
                    <option value="none">None currently</option>
                </select>
            </div>

            <div id="intervals-id-group" class="form-group conditional">
                <label class="form-label" for="intervals_athlete_id">Intervals.icu Athlete ID</label>
                <input type="text" id="intervals_athlete_id" name="intervals_athlete_id" placeholder="e.g., i12345 (found in Settings)">
                <div class="form-help">Found in Intervals.icu → Settings → Developer Settings. Use "i0" for your own account.</div>
            </div>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="trainer_access">Indoor Trainer <span class="required">*</span></label>
                    <select id="trainer_access" name="trainer_access" required>
                        <option value="">Select...</option>
                        <option value="smart">Smart trainer (ERG mode)</option>
                        <option value="basic">Basic/dumb trainer</option>
                        <option value="none">Outdoor only</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="indoor_tolerance">Indoor Tolerance</label>
                    <select id="indoor_tolerance" name="indoor_tolerance">
                        <option value="">Select...</option>
                        <option value="love">Love it - prefer trainer</option>
                        <option value="tolerate">Tolerate it when needed</option>
                        <option value="hate">Hate it - last resort only</option>
                    </select>
                </div>
            </div>

            <!-- ==================== SECTION 6: SCHEDULE ==================== -->
            <div class="section-title">6. Schedule</div>
            <p class="section-help">Your real-life constraints. I'll build around YOUR week.</p>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="hours_per_week">Weekly Training Hours <span class="required">*</span></label>
                    <select id="hours_per_week" name="hours_per_week" required>
                        <option value="">Select...</option>
                        <option value="3-5">3-5 hours</option>
                        <option value="5-7">5-7 hours</option>
                        <option value="8-10">8-10 hours</option>
                        <option value="10-12">10-12 hours</option>
                        <option value="12-15">12-15 hours</option>
                        <option value="15+">15+ hours</option>
                    </select>
                    <div class="form-help">Realistic weekly commitment</div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="current_volume">Current Weekly Hours</label>
                    <select id="current_volume" name="current_volume">
                        <option value="">Select...</option>
                        <option value="0-2">0-2 hours</option>
                        <option value="3-5">3-5 hours</option>
                        <option value="5-7">5-7 hours</option>
                        <option value="8-10">8-10 hours</option>
                        <option value="10+">10+ hours</option>
                    </select>
                    <div class="form-help">What you're actually doing now</div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Best Day(s) for Long Rides <span class="required">*</span></label>
                <div class="form-help" style="margin-bottom: 10px;">Select all that work, or choose flexible</div>
                <div class="checkbox-group">
                    <label class="checkbox-option flexible-option"><input type="checkbox" name="long_ride_days" value="flexible"> Flexible</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="long_ride_days" value="sunday"> Sun</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Best Day(s) for Hard Intervals <span class="required">*</span></label>
                <div class="form-help" style="margin-bottom: 10px;">When do you feel freshest?</div>
                <div class="checkbox-group">
                    <label class="checkbox-option flexible-option"><input type="checkbox" name="interval_days" value="flexible"> Flexible</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="interval_days" value="sunday"> Sun</label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Required Off Days</label>
                <div class="form-help" style="margin-bottom: 10px;">Days you absolutely cannot train</div>
                <div class="checkbox-group">
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="monday"> Mon</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="tuesday"> Tue</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="wednesday"> Wed</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="thursday"> Thu</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="friday"> Fri</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="saturday"> Sat</label>
                    <label class="checkbox-option"><input type="checkbox" name="off_days" value="sunday"> Sun</label>
                </div>
            </div>

            <!-- ==================== SECTION 7: WORK & LIFE ==================== -->
            <div class="section-title">7. Work & Life</div>
            <p class="section-help">Life context affects training capacity. No judgment.</p>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="work_hours">Work Hours/Week</label>
                    <select id="work_hours" name="work_hours">
                        <option value="">Select...</option>
                        <option value="0">Not working</option>
                        <option value="20">Part-time (~20)</option>
                        <option value="40">Full-time (~40)</option>
                        <option value="50">Heavy (~50)</option>
                        <option value="60+">Intense (60+)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="job_stress">Job Stress Level</label>
                    <select id="job_stress" name="job_stress">
                        <option value="">Select...</option>
                        <option value="low">Low - Pretty chill</option>
                        <option value="moderate">Moderate - Normal demands</option>
                        <option value="high">High - Demanding</option>
                        <option value="very_high">Very High - Crushing</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="life_stress">Overall Life Stress <span class="required">*</span></label>
                <select id="life_stress" name="life_stress" required>
                    <option value="">Select...</option>
                    <option value="low">Low - Life is chill, training is my outlet</option>
                    <option value="moderate">Moderate - Normal work/life demands</option>
                    <option value="high">High - Demanding job, family obligations</option>
                    <option value="very_high">Very High - Barely keeping head above water</option>
                </select>
                <div class="form-help">Be honest - this affects recovery capacity</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="family_situation">Family Situation</label>
                <textarea id="family_situation" name="family_situation" placeholder="e.g., Married, 2 kids (ages 3, 5), partner supportive of training" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="time_commitments">Other Regular Commitments</label>
                <textarea id="time_commitments" name="time_commitments" placeholder="e.g., Kids' sports 3x/week, volunteer work, travel for work monthly" rows="2"></textarea>
            </div>

            <!-- ==================== SECTION 8: HEALTH ==================== -->
            <div class="section-title">8. Health</div>
            <p class="section-help">Medical history and current limitations.</p>

            <div class="form-group">
                <label class="form-label" for="injuries">Current Injuries or Limitations</label>
                <textarea id="injuries" name="injuries" placeholder="e.g., Bad right knee (can't do deep squats), lower back tightness on long rides" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="past_injuries">Past Injuries That Still Affect You</label>
                <textarea id="past_injuries" name="past_injuries" placeholder="e.g., ACL surgery 2020 (fully healed but careful with lateral movements)" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="medical_conditions">Medical Conditions</label>
                <textarea id="medical_conditions" name="medical_conditions" placeholder="e.g., Asthma (well controlled), high blood pressure (on medication)" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="medications">Medications</label>
                <textarea id="medications" name="medications" placeholder="e.g., Beta blocker for BP (affects HR), daily multivitamin" rows="2"></textarea>
                <div class="form-help">Include anything that might affect HR or recovery</div>
            </div>

            <!-- ==================== SECTION 9: STRENGTH ==================== -->
            <div class="section-title">9. Strength Training</div>

            <div class="form-group">
                <label class="form-label">Current Strength Training <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="none" required>
                        <div class="radio-label">
                            <div class="radio-title">None</div>
                            <div class="radio-desc">No strength work currently</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="occasional">
                        <div class="radio-label">
                            <div class="radio-title">Occasional</div>
                            <div class="radio-desc">Once a week or less</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="regular">
                        <div class="radio-label">
                            <div class="radio-title">Regular</div>
                            <div class="radio-desc">1-2x per week, consistent</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="strength_current" value="dedicated">
                        <div class="radio-label">
                            <div class="radio-title">Dedicated</div>
                            <div class="radio-desc">2-3x per week, structured</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label">Include Strength?</label>
                    <select id="strength_want" name="strength_want">
                        <option value="">Select...</option>
                        <option value="yes">Yes - Include strength</option>
                        <option value="no">No - Cycling only</option>
                        <option value="coach_decides">You decide</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Equipment Access</label>
                    <select id="strength_equipment" name="strength_equipment">
                        <option value="">Select...</option>
                        <option value="full_gym">Full gym</option>
                        <option value="home_weights">Home weights (DB/KB)</option>
                        <option value="minimal">Minimal (bands/bodyweight)</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>

            <!-- ==================== SECTION 10: COACHING PREFERENCES ==================== -->
            <div class="section-title">10. Coaching Preferences</div>
            <p class="section-help">How do you want to work together?</p>

            <div class="inline-fields">
                <div class="form-group">
                    <label class="form-label" for="checkin_frequency">Check-in Frequency <span class="required">*</span></label>
                    <select id="checkin_frequency" name="checkin_frequency" required>
                        <option value="">Select...</option>
                        <option value="daily">Daily briefings</option>
                        <option value="few_times_week">Few times a week</option>
                        <option value="weekly">Weekly summary only</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="feedback_detail">Feedback Detail <span class="required">*</span></label>
                    <select id="feedback_detail" name="feedback_detail" required>
                        <option value="">Select...</option>
                        <option value="minimal">Minimal - Just tell me what to do</option>
                        <option value="moderate">Moderate - Key points only</option>
                        <option value="comprehensive">Comprehensive - Explain everything</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Autonomy Preference <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="autonomy" value="prescriptive" required>
                        <div class="radio-label">
                            <div class="radio-title">Tell Me Exactly</div>
                            <div class="radio-desc">Precise workouts, I'll execute as written</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="autonomy" value="guided">
                        <div class="radio-label">
                            <div class="radio-title">General Guidance</div>
                            <div class="radio-desc">Goals and guidelines, I'll adapt to the day</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="autonomy" value="high">
                        <div class="radio-label">
                            <div class="radio-title">High Autonomy</div>
                            <div class="radio-desc">Weekly targets, I decide the details</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="communication_style">Communication Style</label>
                <select id="communication_style" name="communication_style">
                    <option value="">Select...</option>
                    <option value="direct">Direct / No-BS</option>
                    <option value="encouraging">Encouraging / Supportive</option>
                    <option value="data_driven">Data-Driven / Analytical</option>
                    <option value="flexible">Mix - You decide</option>
                </select>
            </div>

            <!-- ==================== SECTION 11: MENTAL GAME ==================== -->
            <div class="section-title">11. Mental Game</div>
            <p class="section-help">These help me understand how you tick. Answer honestly.</p>

            <div class="form-group">
                <label class="form-label">When you miss a planned workout, what do you usually do? <span class="required">*</span></label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="missed_workout_response" value="make_up" required>
                        <div class="radio-label">
                            <div class="radio-title">Make It Up ASAP</div>
                            <div class="radio-desc">Even if it means back-to-back hard days</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="missed_workout_response" value="move_on">
                        <div class="radio-label">
                            <div class="radio-title">Move On</div>
                            <div class="radio-desc">Trust the process, one workout won't matter</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="missed_workout_response" value="guilt">
                        <div class="radio-label">
                            <div class="radio-title">Feel Guilty</div>
                            <div class="radio-desc">Beat myself up but eventually let it go</div>
                        </div>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="missed_workout_response" value="spiral">
                        <div class="radio-label">
                            <div class="radio-title">Spiral</div>
                            <div class="radio-desc">Start questioning everything</div>
                        </div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="best_training_block">Describe your best training period ever. What made it work?</label>
                <textarea id="best_training_block" name="best_training_block" placeholder="e.g., Spring 2024 - consistent schedule, no travel, riding with a group weekly, slept well, wasn't stressed about work" rows="3"></textarea>
                <div class="form-help">This reveals your success conditions</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="quit_triggers">What would make you quit or lose motivation?</label>
                <textarea id="quit_triggers" name="quit_triggers" placeholder="e.g., Injury, work getting crazy, feeling like I'm not improving, too much time on trainer" rows="2"></textarea>
                <div class="form-help">Helps me identify risk factors early</div>
            </div>

            <div class="form-group">
                <label class="form-label" for="accountability_style">Who knows about your race goal?</label>
                <select id="accountability_style" name="accountability_style">
                    <option value="">Select...</option>
                    <option value="public">Everyone - Posted on social media</option>
                    <option value="friends">Close friends and family</option>
                    <option value="private">Just me and my coach</option>
                    <option value="secret">Nobody yet</option>
                </select>
                <div class="form-help">Reveals your accountability style</div>
            </div>

            <!-- ==================== SECTION 12: ANYTHING ELSE ==================== -->
            <div class="section-title">12. Anything Else</div>

            <div class="form-group">
                <label class="form-label" for="previous_coach">Have you worked with a coach before?</label>
                <textarea id="previous_coach" name="previous_coach" placeholder="If yes, what did you like or dislike about the experience?" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="anything_else">Anything else I should know?</label>
                <textarea id="anything_else" name="anything_else" placeholder="Travel plans, upcoming life changes, specific concerns, questions..." rows="3"></textarea>
            </div>

            <div style="display: flex; align-items: center; margin-top: 24px;">
                <button type="button" class="save-btn" id="save-btn">Save Progress</button>
                <button type="submit" class="submit-btn" id="submit-btn" style="flex: 1;">
                    Submit Questionnaire
                </button>
            </div>
        </form>

        <div class="footer">
            <p>Your information is kept confidential and used only for coaching purposes. Questions? Email matti@gravelgod.com</p>
        </div>
    </div>

    <script>
        // W/kg category thresholds
        const CATEGORIES_MALE = [
            { min: 5.0, cat: 'Pro / Cat 1', desc: 'Elite level' },
            { min: 4.2, cat: 'Cat 2', desc: 'Very strong amateur' },
            { min: 3.7, cat: 'Cat 3', desc: 'Strong recreational' },
            { min: 3.2, cat: 'Cat 4', desc: 'Fit recreational' },
            { min: 2.5, cat: 'Cat 5', desc: 'Beginner racer' },
            { min: 0, cat: 'Recreational', desc: 'Building fitness' }
        ];

        const CATEGORIES_FEMALE = [
            { min: 4.3, cat: 'Pro / Cat 1', desc: 'Elite level' },
            { min: 3.6, cat: 'Cat 2', desc: 'Very strong amateur' },
            { min: 3.2, cat: 'Cat 3', desc: 'Strong recreational' },
            { min: 2.8, cat: 'Cat 4', desc: 'Fit recreational' },
            { min: 2.2, cat: 'Cat 5', desc: 'Beginner racer' },
            { min: 0, cat: 'Recreational', desc: 'Building fitness' }
        ];

        // Progress tracking
        function updateProgress() {
            const form = document.getElementById('intake-form');
            const required = form.querySelectorAll('[required]');
            let filled = 0;
            required.forEach(el => {
                if (el.type === 'radio') {
                    const name = el.name;
                    if (form.querySelector(`input[name="${name}"]:checked`)) filled++;
                } else if (el.value) {
                    filled++;
                }
            });
            // Count unique required groups
            const uniqueRequired = new Set();
            required.forEach(el => uniqueRequired.add(el.name));
            const total = uniqueRequired.size;

            const percent = Math.round((filled / total) * 100);
            document.getElementById('progress-fill').style.width = percent + '%';
            document.getElementById('progress-text').textContent = percent + '% complete';
        }

        // Calculate W/kg and category
        function calculateMetrics() {
            const ftp = parseFloat(document.getElementById('ftp').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const sex = document.getElementById('sex').value;

            const calcDisplay = document.getElementById('calc-display');
            const wpkgEl = document.getElementById('calc-wpkg');
            const catEl = document.getElementById('calc-category');

            if (ftp && weight && sex) {
                const weightKg = weight * 0.453592;
                const wpkg = (ftp / weightKg).toFixed(2);

                const categories = sex === 'female' ? CATEGORIES_FEMALE : CATEGORIES_MALE;
                const category = categories.find(c => wpkg >= c.min);

                wpkgEl.textContent = wpkg + ' W/kg';
                catEl.textContent = category ? `${category.cat} (${category.desc})` : '-';

                document.getElementById('watts_per_kg').value = wpkg;
                document.getElementById('estimated_category').value = category ? category.cat : '';

                calcDisplay.classList.remove('hidden');
            } else {
                calcDisplay.classList.add('hidden');
            }
        }

        // Blindspot and trait inference
        function inferTraits() {
            const blindspots = [];
            const traits = [];

            // Recovery/sleep
            const sleep = document.getElementById('sleep_quality').value;
            if (sleep === 'poor' || sleep === 'fair') {
                blindspots.push('Recovery Deficit');
            }

            // Life stress
            const stress = document.getElementById('life_stress').value;
            if (stress === 'high' || stress === 'very_high') {
                blindspots.push('Life Stress Overload');
            }

            // Strength
            const strength = document.querySelector('input[name="strength_current"]:checked');
            if (strength && (strength.value === 'none' || strength.value === 'occasional')) {
                blindspots.push('Movement Quality Gap');
            }

            // Injuries
            const injuries = document.getElementById('injuries').value;
            if (injuries && injuries.trim().length > 0) {
                blindspots.push('Injury Management');
            }

            // Time-crunched
            const hours = document.getElementById('hours_per_week').value;
            if (hours === '3-5' || hours === '5-7') {
                blindspots.push('Time-Crunched');
            }

            // Masters
            const age = parseInt(document.getElementById('age').value);
            if (age >= 45) {
                blindspots.push('Masters Recovery');
            }
            if (age >= 55) {
                blindspots.push('Extended Recovery Needs');
            }

            // Overtraining history
            const overtrain = document.getElementById('overtraining_history').value;
            if (overtrain === 'multiple' || overtrain === 'currently') {
                blindspots.push('Overtraining Risk');
            }

            // Mental traits from missed workout response
            const missedResponse = document.querySelector('input[name="missed_workout_response"]:checked');
            if (missedResponse) {
                if (missedResponse.value === 'make_up') {
                    traits.push('Perfectionist tendency');
                } else if (missedResponse.value === 'move_on') {
                    traits.push('Healthy flexibility');
                } else if (missedResponse.value === 'spiral') {
                    traits.push('Needs reassurance');
                }
            }

            // Accountability style
            const accountability = document.getElementById('accountability_style').value;
            if (accountability === 'public') {
                traits.push('External accountability');
            } else if (accountability === 'secret' || accountability === 'private') {
                traits.push('Internal accountability');
            }

            document.getElementById('blindspots').value = blindspots.join(',');
            document.getElementById('inferred_traits').value = traits.join(',');
        }

        // Conditional fields
        function handleConditionals() {
            // Show race details if specific_race selected
            const goalRadio = document.querySelector('input[name="primary_goal"]:checked');
            const raceDetails = document.getElementById('race-details');
            if (goalRadio && goalRadio.value === 'specific_race') {
                raceDetails.classList.add('show');
            } else {
                raceDetails.classList.remove('show');
            }

            // Show Intervals.icu ID field if that platform selected
            const platform = document.getElementById('training_platform').value;
            const intervalsGroup = document.getElementById('intervals-id-group');
            if (platform === 'intervals_icu') {
                intervalsGroup.classList.add('show');
            } else {
                intervalsGroup.classList.remove('show');
            }
        }

        // Radio option selection styling
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', function() {
                const input = this.querySelector('input');
                const name = input.name;
                document.querySelectorAll(`.radio-option input[name="${name}"]`).forEach(inp => {
                    inp.closest('.radio-option').classList.remove('selected');
                });
                this.classList.add('selected');
                input.checked = true;
                updateProgress();
                handleConditionals();
            });
        });

        // Checkbox option selection styling with Flexible logic
        document.querySelectorAll('.checkbox-option').forEach(option => {
            option.addEventListener('click', function(e) {
                const input = this.querySelector('input');
                if (e.target.tagName !== 'INPUT') {
                    input.checked = !input.checked;
                }

                const name = input.name;
                const value = input.value;
                const isChecked = input.checked;

                // Handle "Flexible" mutual exclusivity
                if (value === 'flexible' && isChecked) {
                    document.querySelectorAll(`input[name="${name}"]`).forEach(inp => {
                        if (inp.value !== 'flexible') {
                            inp.checked = false;
                            inp.closest('.checkbox-option').classList.remove('selected');
                        }
                    });
                } else if (value !== 'flexible' && isChecked) {
                    const flexibleInput = document.querySelector(`input[name="${name}"][value="flexible"]`);
                    if (flexibleInput) {
                        flexibleInput.checked = false;
                        flexibleInput.closest('.checkbox-option').classList.remove('selected');
                    }
                }

                this.classList.toggle('selected', input.checked);
                updateProgress();
            });
        });

        // Event listeners
        document.getElementById('ftp').addEventListener('input', calculateMetrics);
        document.getElementById('weight').addEventListener('input', calculateMetrics);
        document.getElementById('sex').addEventListener('change', calculateMetrics);
        document.getElementById('training_platform').addEventListener('change', handleConditionals);

        // Track all inputs for progress
        document.querySelectorAll('input, select, textarea').forEach(el => {
            el.addEventListener('change', updateProgress);
            el.addEventListener('input', updateProgress);
        });

        // Save progress to localStorage
        document.getElementById('save-btn').addEventListener('click', function() {
            const form = document.getElementById('intake-form');
            const formData = new FormData(form);
            const data = {};

            formData.forEach((value, key) => {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            });

            localStorage.setItem('athlete_questionnaire_progress', JSON.stringify(data));
            showMessage('info', 'Progress saved! You can close this page and return later.');
        });

        // Restore progress from localStorage
        function restoreProgress() {
            const saved = localStorage.getItem('athlete_questionnaire_progress');
            if (!saved) return;

            try {
                const data = JSON.parse(saved);

                Object.entries(data).forEach(([key, value]) => {
                    const elements = document.querySelectorAll(`[name="${key}"]`);
                    elements.forEach(el => {
                        if (el.type === 'checkbox') {
                            const values = Array.isArray(value) ? value : [value];
                            el.checked = values.includes(el.value);
                            if (el.checked) {
                                el.closest('.checkbox-option')?.classList.add('selected');
                            }
                        } else if (el.type === 'radio') {
                            el.checked = el.value === value;
                            if (el.checked) {
                                el.closest('.radio-option')?.classList.add('selected');
                            }
                        } else {
                            el.value = value;
                        }
                    });
                });

                updateProgress();
                handleConditionals();
                calculateMetrics();
                showMessage('info', 'Previous progress restored. Continue where you left off.');
            } catch (e) {
                console.error('Error restoring progress:', e);
            }
        }

        // Form submission
        document.getElementById('intake-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submit-btn');

            // Infer traits before submission
            inferTraits();

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());

            // Collect checkbox values as arrays
            data.devices = formData.getAll('devices');
            data.long_ride_days = formData.getAll('long_ride_days');
            data.interval_days = formData.getAll('interval_days');
            data.off_days = formData.getAll('off_days');

            // Honeypot check
            if (data.website) {
                showMessage('error', 'Submission blocked.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Questionnaire';
                return;
            }

            // Validate required checkboxes
            if (!data.long_ride_days || data.long_ride_days.length === 0) {
                showMessage('error', 'Please select at least one day for long rides.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Questionnaire';
                return;
            }

            if (!data.interval_days || data.interval_days.length === 0) {
                showMessage('error', 'Please select at least one day for intervals.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Questionnaire';
                return;
            }

            // For now, show success and copy data (replace with actual endpoint later)
            console.log('Form data:', data);

            // Create formatted output for copying
            const output = formatSubmission(data);

            showMessage('success', `
                <strong>Questionnaire Complete!</strong><br><br>
                Your responses have been saved. Copy the data below and send to your coach, or wait for automatic processing.<br><br>
                <textarea readonly onclick="this.select()" style="width: 100%; min-height: 200px; margin-top: 12px; font-family: monospace; font-size: 11px; padding: 8px;">${output}</textarea>
            `);

            // Clear localStorage on successful submission
            localStorage.removeItem('athlete_questionnaire_progress');

            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Questionnaire';
        });

        function formatSubmission(data) {
            return `# Athlete Intake: ${data.name}
Email: ${data.email}
Submitted: ${new Date().toISOString()}

## Basic Info
- Age: ${data.age}
- Sex: ${data.sex}
- Weight: ${data.weight} lbs
- Height: ${data.height_ft}'${data.height_in}"

## Goals
- Primary Goal: ${data.primary_goal}
${data.race_list ? `- Races: ${data.race_list}` : ''}
${data.success_definition ? `- Success: ${data.success_definition}` : ''}
${data.obstacles ? `- Obstacles: ${data.obstacles}` : ''}

## Current Fitness
- Years Cycling: ${data.years_cycling}
- Years Structured: ${data.years_structured || 'N/A'}
- Longest Recent Ride: ${data.longest_ride}
- FTP: ${data.ftp || 'Unknown'} W
- W/kg: ${data.watts_per_kg || 'Unknown'}
- Estimated Category: ${data.estimated_category || 'Unknown'}
${data.strengths ? `- Strengths: ${data.strengths}` : ''}
${data.weaknesses ? `- Weaknesses: ${data.weaknesses}` : ''}

## Recovery & Baselines
- Resting HR: ${data.rhr_baseline} bpm
- Typical Sleep: ${data.sleep_hours_baseline} hrs
- HRV Baseline: ${data.hrv_baseline || 'Unknown'} ms
- Sleep Quality: ${data.sleep_quality}
- Recovery Speed: ${data.recovery_speed}
- Overtraining History: ${data.overtraining_history || 'N/A'}

## Equipment & Data
- Devices: ${Array.isArray(data.devices) ? data.devices.join(', ') : data.devices || 'None'}
- Platform: ${data.training_platform}
- Intervals.icu ID: ${data.intervals_athlete_id || 'N/A'}
- Indoor Trainer: ${data.trainer_access}
- Indoor Tolerance: ${data.indoor_tolerance || 'N/A'}

## Schedule
- Weekly Hours Available: ${data.hours_per_week}
- Current Volume: ${data.current_volume || 'N/A'}
- Long Ride Days: ${Array.isArray(data.long_ride_days) ? data.long_ride_days.join(', ') : data.long_ride_days}
- Interval Days: ${Array.isArray(data.interval_days) ? data.interval_days.join(', ') : data.interval_days}
- Off Days: ${Array.isArray(data.off_days) ? data.off_days.join(', ') : 'Flexible'}

## Work & Life
- Work Hours: ${data.work_hours || 'N/A'}
- Job Stress: ${data.job_stress || 'N/A'}
- Life Stress: ${data.life_stress}
${data.family_situation ? `- Family: ${data.family_situation}` : ''}
${data.time_commitments ? `- Commitments: ${data.time_commitments}` : ''}

## Health
${data.injuries ? `- Current Injuries: ${data.injuries}` : '- Current Injuries: None'}
${data.past_injuries ? `- Past Injuries: ${data.past_injuries}` : ''}
${data.medical_conditions ? `- Medical Conditions: ${data.medical_conditions}` : ''}
${data.medications ? `- Medications: ${data.medications}` : ''}

## Strength
- Current: ${data.strength_current}
- Include: ${data.strength_want || 'N/A'}
- Equipment: ${data.strength_equipment || 'N/A'}

## Coaching Preferences
- Check-in Frequency: ${data.checkin_frequency}
- Feedback Detail: ${data.feedback_detail}
- Autonomy: ${data.autonomy}
- Communication Style: ${data.communication_style || 'N/A'}

## Mental Game
- Missed Workout Response: ${data.missed_workout_response}
${data.best_training_block ? `- Best Training Block: ${data.best_training_block}` : ''}
${data.quit_triggers ? `- Quit Triggers: ${data.quit_triggers}` : ''}
- Accountability Style: ${data.accountability_style || 'N/A'}

## Additional
${data.previous_coach ? `- Previous Coach Experience: ${data.previous_coach}` : ''}
${data.anything_else ? `- Other Notes: ${data.anything_else}` : ''}

## Inferred
- Blindspots: ${data.blindspots || 'None identified'}
- Traits: ${data.inferred_traits || 'None identified'}
`;
        }

        function showMessage(type, text) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = text;
            messageDiv.classList.remove('hidden');
            messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Initialize
        restoreProgress();
        updateProgress();
        handleConditionals();
    </script>
</body>
</html>
